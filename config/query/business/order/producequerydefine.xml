<?xml version="1.0" encoding="UTF-8"?>
<root>
  <query>
    <pool></pool>     
    <name value="getOrderListForTask" />
    <where>
      <w name="A.full_field" des=""  reqName="keyword1" dtype="ch" oper="like"  lg="AND" bt="" />
   	  <w name="A.full_field" des=""  reqName="keyword2" dtype="ch" oper="like"  lg="AND" bt="" />
   	  <w name="A.orderType"  des=""  reqName="orderType" dtype="ch" oper="="  lg="AND" bt="" />
    </where>
    <select>
      <f name="IFNULL(A.machineModel,'')" alias="machineModel" ctype="" />
      <f name="IFNULL(b.YSId,'')" alias="mergeYsid" ctype="" />
      <f name="IF(b.mergeId IS NULL,'0','1')" alias="lastCheceked" ctype="" />
      <f name="b.viewFlag" alias="" ctype="" />
      <f name="b.mergeId" alias="" ctype="" />
      <f name="IFNULL(c.YSId,'')" alias="hideYsid" ctype="" />
      <f name="IFNULL(c.hideFlag,'F')" alias="hideFlag" ctype="" />
      <f name="A.materialId" alias="" ctype="" />
      <f name="A.materialName" alias="" ctype="" />
      <f name="A.PIId" alias="" ctype="" />
      <f name="A.YSId" alias="" ctype="" />
      <f name="A.orderQty" alias="" ctype="" />
      <f name="A.totalQuantity" alias="" ctype="" />
      <f name="A.orderDate" alias="" ctype="" />
      <f name="A.deliveryDate" alias="" ctype="" />
      <f name="A.deliveryDate" alias="MaxDeliveryDate" ctype="" />
      <f name="A.currency" alias="" ctype="币种" />
      <f name="A.currency" alias="currencyId" ctype="" />
      <f name="A.team" alias="" ctype="业务组" />
      <f name="A.orderType" alias="" ctype="" />
      <f name="A.completedQuantity" alias="" ctype="" />
      <f name="A.customerId" alias="" ctype="" />
      <f name="A.shortName" alias="" ctype="" />
      <f name="A.divertYsid" alias="" ctype="" />
      <f name="A.diverFlag" alias="" ctype="" />
    </select>
    <!-- status = '0' 表示 订单状态为 "新建"  A.status = '0' AND   -->
    <from>
      (
		SELECT
			COUNT(a.stockinQty) stockinCnt,
			SUM(a.stockinQty) stockinQty,
			a.completedQuantity,
			IF(SUM(a.stockinQty) &lt;=0,a.completedQuantity,SUM(a.stockinQty)) computeStockinQty,
			MAX(a.checkInDate) checkInDate,
			a.PIId,
			a.YSId,A.machineModel,
			a.materialId,A.materialName,
			a.orderQty,a.totalQuantity,
			a.divertYsid,A.diverFlag,A.customerId,A.shortName,A.orderType,A.team,A.currency,A.deliveryDate,A.orderDate,A.totalprice,
			a.full_field
		FROM
			(
				SELECT 
					a.PIId,
					a.YSId,A.machineModel,
					a.materialId,A.materialName,
					REPLACE(a.quantity,',','') orderQty,
					REPLACE(a.totalQuantity,',','') totalQuantity,
					REPLACE(IFNULL(a.completedQuantity,0),',','') completedQuantity,
					REPLACE(IFNULL(b.quantity,0),',','') stockinQty,
					b.checkInDate,
					a.full_field,
					a.divertYsid,A.diverFlag,A.customerId,A.shortName,A.orderType,A.team,A.currency,A.deliveryDate,A.orderDate,A.totalprice
				FROM 
					v_orderlist AS a
					LEFT JOIN v_purchasestockindetail AS b ON b.YSId = a.YSId AND b.materialId=a.materialId
				WHERE SUBSTRING_INDEX(SUBSTRING_INDEX(A.materialId,'.',2),'.',-1) NOT IN ('BTR','BNC','CGR','PJ')
					  AND 	REPLACE(IFNULL(a.completedQuantity,0),',','')+0 &lt; REPLACE(a.quantity,',','')+0
					  AND  #0 
			) a
			GROUP BY a.YSId,a.materialId
		 	HAVING #2
		 
      ) AS A  
    	LEFT JOIN b_OrderMergeDetail b ON a.YSId=b.ysid AND b.deleteFlag = '0'
    	LEFT JOIN b_OrderProduceHide c ON a.YSId=c.ysid AND c.deleteFlag = '0'
      WHERE 1=1 
    </from>
    <orderby>IFNULL(b.mergeId,'0')  DESC,IFNULL(b.YSId,a.YSId),mid(A.YSId,LOCATE('-',A.YSId)+1,2)+0</orderby>
    <groupby></groupby>
    <having>#1</having>
	<power>
	</power>    
  </query>
  <query>
    <pool></pool>     
    <name value="getOrderListForTaskGroup" />
    <where>
      <w name="A.full_field" des=""  reqName="keyword1" dtype="ch" oper="like"  lg="AND" bt="" />
   	  <w name="A.full_field" des=""  reqName="keyword2" dtype="ch" oper="like"  lg="AND" bt="" />
   	  <w name="A.orderType"  des=""  reqName="orderType" dtype="ch" oper="="  lg="AND" bt="" />
    </where>
    <select>
      <f name="IFNULL(A.machineModel,'')" alias="machineModel" ctype="" />
      <f name="IF(b.mergeId IS NULL,a.ysid,'***')" alias="YSId" ctype="" />
      <f name="IF(b.mergeId IS NULL,a.materialId,'***')" alias="materialId" ctype="" />
      <f name="IF(b.mergeId IS NULL,a.materialName,'***')" alias="materialName" ctype="" />
      <f name="IF(b.mergeId IS NULL,a.team,'***')" alias="team" ctype="业务组" />
      <f name="IF(b.mergeId IS NULL,'0','1')" alias="lastCheceked" ctype="" />
      <f name="b.viewFlag" alias="" ctype="" />
      <f name="b.mergeId" alias="" ctype="" />
      <f name="A.PIId" alias="" ctype="" />
      <f name="SUM(REPLACE(A.orderQty,',',''))" alias="orderQty" ctype="" />
      <f name="A.totalQuantity" alias="" ctype="" />
      <f name="A.orderDate" alias="" ctype="" />
      <f name="MIN(A.deliveryDate)" alias="deliveryDate" ctype="" />
      <f name="MAX(A.deliveryDate)" alias="MaxDeliveryDate" ctype="" />
      <f name="A.orderType" alias="" ctype="" />
      <f name="A.completedQuantity" alias="" ctype="" />
      <f name="A.customerId" alias="" ctype="" />
      <f name="A.shortName" alias="" ctype="" />
      <f name="A.divertYsid" alias="" ctype="" />
      <f name="A.diverFlag" alias="" ctype="" />
    </select>
    <!-- status = '0' 表示 订单状态为 "新建"  A.status = '0' AND   -->
    <from>
      (
		SELECT
			COUNT(a.stockinQty) stockinCnt,
			SUM(a.stockinQty) stockinQty,
			a.completedQuantity,
			IF(SUM(a.stockinQty) &lt;=0,a.completedQuantity,SUM(a.stockinQty)) computeStockinQty,
			MAX(a.checkInDate) checkInDate,
			a.PIId,
			a.YSId,A.machineModel,
			a.materialId,A.materialName,
			a.orderQty,a.totalQuantity,
			a.divertYsid,A.diverFlag,A.customerId,A.shortName,A.orderType,A.team,A.currency,A.deliveryDate,A.orderDate,A.totalprice,
			a.full_field
		FROM
			(
			SELECT 
				a.PIId,
				a.YSId,A.machineModel,
				a.materialId,A.materialName,
				REPLACE(a.quantity,',','') orderQty,
				REPLACE(a.totalQuantity,',','') totalQuantity,
				REPLACE(IFNULL(a.completedQuantity,0),',','') completedQuantity,
				REPLACE(IFNULL(b.quantity,0),',','') stockinQty,
				b.checkInDate,
				a.full_field,
				a.divertYsid,A.diverFlag,A.customerId,A.shortName,A.orderType,A.team,A.currency,A.deliveryDate,A.orderDate,A.totalprice
			FROM 
				v_orderlist AS a
				LEFT JOIN v_purchasestockindetail AS b ON b.YSId = a.YSId AND b.materialId=a.materialId
			WHERE a.deleteFlag = '0' AND SUBSTRING_INDEX(SUBSTRING_INDEX(A.materialId,'.',2),'.',-1) NOT IN ('BTR','BNC','CGR','PJ')
					AND  #0 
			) a
		GROUP BY a.YSId,a.materialId
		HAVING computeStockinQty+0 &lt; orderQty+0
      ) AS A 
	      LEFT JOIN b_OrderMergeDetail b ON a.YSId=b.ysid AND b.deleteFlag = '0'
		  LEFT JOIN b_orderproducehide c ON a.ysid=c.ysid AND c.deleteFlag = '0'
    	
      WHERE  c.ysid IS  NULL
    </from>
    <orderby>IFNULL(b.mergeId,'0')  DESC,IFNULL(b.YSId,a.YSId)</orderby>
    <groupby>IFNULL(b.mergeId,a.YSId)</groupby>
    <having></having>
	<power></power>    
  </query>
  <query>
    <pool></pool>     
    <name value="produceLineTopCodeIdList" />
    <where>
   		<w name="A.codeId" des=""  reqName="codeId" dtype="ch" oper="="  lg="AND" bt="" />
    </where>
    <select>
      <f name="A.recordId" alias="" ctype="" />
      <f name="A.codeId" alias="" ctype="" />
      <f name="A.parentId" alias="" ctype="" />
      <f name="A.subId" alias="" ctype="" />
      <f name="A.multiLevel" alias="" ctype="" />
      <f name="A.sortNo" alias="" ctype="" />
      <f name="A.effectiveFlag" alias="" ctype="" />
      <f name="A.remarks" alias="" ctype="" />
    </select>
    <from>
		s_produceLineCode a
		where a.parentId='0'
	</from>
    <orderby>a.sortNo</orderby>
    <groupby></groupby>
    <having></having>
	<power></power>    
  </query>
  <query>
    <pool></pool>    
    <name value="getMAXParentCode" />
     <where>
       <w name="A.parentId" des=""  reqName="parentId" dtype="ch" oper="="  lg="AND" bt="" />
    </where>
  <select>
      <f name="IFNULL(subId,'0')" alias="MaxSubId" ctype="" />
      <f name="codeName" alias="" ctype="" />
      <f name="parentId" alias="" ctype="" />
      <f name="codeId" alias="" ctype="" />
      <f name="sortNo" alias="" ctype="" />
  </select>
    <from> s_produceLineCode a </from>
    <orderby> a.sortNo DESC</orderby>
    <groupby></groupby>
    <having></having>
	<power>
	</power>    
  </query>
  <query>
    <pool></pool>     
    <name value="getProduceLineCodeList" />
    <where>
    </where>
    <select>
      <f name="A.recordId" alias="" ctype="" />
      <f name="A.codeId" alias="" ctype="" />
      <f name="a.codeType" alias="" ctype="" />
      <f name="a.codeName" alias="" ctype="" />
      <f name="A.parentId" alias="" ctype="" />
      <f name="A.subId" alias="" ctype="" />
      <f name="A.multiLevel" alias="" ctype="" />
      <f name="A.sortNo" alias="" ctype="" />
      <f name="A.effectiveFlag" alias="" ctype="" />
      <f name="A.remarks" alias="" ctype="" />
    </select>
    <from>
		(
			SELECT 
			a.codeId,
			a.codeName,
			a.recordId,
			a.parentId,
			a.subId,
			a.multiLevel,
			a.sortNo,
			a.effectiveFlag,
			a.remarks,
			substring_index( substring_index( a.codeType, ',', b.help_topic_id + 1 ), ',',-1 ) codeType
			FROM 
				(
				SELECT 					
					a.codeId,
					a.codeName,
					a.codeType,
					a.recordId,
					a.parentId,
					a.subId,
					a.multiLevel,
					a.sortNo,
					a.effectiveFlag,
					a.remarks
				FROM s_produceLineCode s 
				JOIN s_produceLineCode a ON s.sortNo = SUBSTR(a.sortNo FROM 1 FOR LENGTH(s.sortNo)) AND a.deleteFlag='0'
				WHERE s.deleteFlag='0'
				) a
			LEFT JOIN mysql.help_topic b ON b.help_topic_id &lt; ( length( a.codeType ) - length( REPLACE ( a.codeType, ',', '' ) ) + 1 ) 
			
			ORDER BY codeType
		) a
	</from>
    <orderby>a.sortNo</orderby>
    <groupby>a.codeId</groupby>
    <having></having>
	<power></power>    
  </query> 
  <query>
    <pool></pool>     
    <name value="getProduceLineCode" />
    <where></where>
    <select>
      <f name="A.codeId" alias="" ctype="" />
      <f name="A.codeName" alias="" ctype="" />
      <f name="a.SortNo" alias="" ctype="" />
    </select>
    <from>s_producelinecode a WHERE parentId='0' and a.deleteFlag='0'</from>
    <orderby>a.codeId</orderby>
    <groupby></groupby>
    <having></having>
	<power></power>    
  </query> 
  <query>
    <pool></pool>     
    <name value="getProduceTaskForPlan" />
    <where>
      <w name="A.full_field" des=""  reqName="keyword1" dtype="ch" oper="like"  lg="AND" bt="" />
   	  <w name="A.full_field" des=""  reqName="keyword2" dtype="ch" oper="like"  lg="AND" bt="" />
   	  <w name="A.orderType"  des=""  reqName="orderType" dtype="ch" oper="="  lg="AND" bt="" />
   	  <w name="e.produceLine"  des=""  reqName="produceLine" dtype="ch" oper="="  lg="AND" bt="" />
    </where>
    <select>
      <f name="IFNULL(A.machineModel,'')" alias="machineModel" ctype="" />
      <f name="IFNULL(b.YSId,'')" alias="mergeYsid" ctype="" />
      <f name="IF(b.mergeId IS NULL,'0','1')" alias="lastCheceked" ctype="" />
      <f name="b.viewFlag" alias="" ctype="" />
      <f name="b.mergeId" alias="" ctype="" />
      <f name="IFNULL(c.YSId,'')" alias="hideYsid" ctype="" />
      <f name="IFNULL(c.hideFlag,'F')" alias="hideFlag" ctype="" />
      <f name="A.materialId" alias="" ctype="" />
      <f name="A.materialName" alias="" ctype="" />
      <f name="A.PIId" alias="" ctype="" />
      <f name="A.YSId" alias="" ctype="" />
      <f name="A.computeStockinQty" alias="" ctype="" />
      <f name="A.orderQty" alias="" ctype="" />
      <f name="A.totalQuantity" alias="" ctype="" />
      <f name="A.orderDate" alias="" ctype="" />
      <f name="A.deliveryDate" alias="" ctype="" />
      <f name="A.deliveryDate" alias="MaxDeliveryDate" ctype="" />
      <f name="A.currency" alias="" ctype="币种" />
      <f name="A.currency" alias="currencyId" ctype="" />
      <f name="A.team" alias="" ctype="业务组" />
      <f name="A.orderType" alias="" ctype="" />
      <f name="A.completedQuantity" alias="" ctype="" />
      <f name="A.customerId" alias="" ctype="" />
      <f name="A.shortName" alias="" ctype="" />
      <f name="A.divertYsid" alias="" ctype="" />
      <f name="A.diverFlag" alias="" ctype="" />
      <f name="IF(e.produceLine IS NULL,'0','1')" alias="produceLineFlag" ctype="" />
      <f name="IFNULL(e.produceLine,'')" alias="produceLine" ctype="" />
      <f name="e.sortNo" alias="" ctype="" />
      <f name="IFNULL(f.filterType,'')" alias="filterType" ctype="" />
      <f name="IF(f.filterType IS NULL,'0','1')" alias="filterFlag" ctype="" />
      <f name="IFNULL(e.finishFlag,'0')" alias="finishFlag" ctype="" />
      <f name="IFNULL(e.readyDate,'')" alias="readyDate" ctype="" />
      <f name="IFNULL(e.remarks,'')" alias="remarks" ctype="" />
    </select>
    <from>
      (
		SELECT
			COUNT(a.stockinQty) stockinCnt,
			SUM(a.stockinQty) stockinQty,
			a.completedQuantity,
			IF(SUM(a.stockinQty) &lt;=0,a.completedQuantity,SUM(a.stockinQty)) computeStockinQty,
			MAX(a.checkInDate) checkInDate,
			a.PIId,
			a.YSId,A.machineModel,
			a.materialId,A.materialName,
			a.orderQty,a.totalQuantity,
			a.divertYsid,A.diverFlag,A.customerId,A.shortName,A.orderType,A.team,A.currency,A.deliveryDate,A.orderDate,A.totalprice,
			a.full_field
		FROM
			(
				SELECT 
					a.PIId,
					a.YSId,A.machineModel,
					a.materialId,A.materialName,
					REPLACE(a.quantity,',','') orderQty,
					REPLACE(a.totalQuantity,',','') totalQuantity,
					REPLACE(IFNULL(a.completedQuantity,0),',','') completedQuantity,
					REPLACE(IFNULL(b.quantity,0),',','') stockinQty,
					b.checkInDate,
					a.full_field,
					a.divertYsid,A.diverFlag,A.customerId,A.shortName,A.orderType,A.team,A.currency,A.deliveryDate,A.orderDate,A.totalprice
				FROM 
					v_orderlist AS a
					LEFT JOIN v_purchasestockindetail AS b ON b.YSId = a.YSId AND b.materialId=a.materialId
				WHERE 
					#3
					AND
				  	#0 
			) a
			GROUP BY a.YSId,a.materialId
		 	HAVING #2
		 
      ) AS A  
    	LEFT JOIN b_OrderMergeDetail 	b ON a.YSId=b.ysid AND b.deleteFlag = '0'
    	LEFT JOIN b_OrderProduceHide 	c ON a.YSId=c.ysid AND c.deleteFlag = '0'
		LEFT JOIN b_ProducePlan  		e ON a.YSId=e.YSId AND e.deleteFlag = '0'
		LEFT JOIN b_ProducePlanFilter 	f ON a.YSId=f.YSId AND f.deleteFlag = '0'
      WHERE 1=1 
    </from>
    <orderby>#4</orderby>
    <groupby></groupby>
    <!-- hideFlag='F 不显示隐藏数据   -->
    <having>#1</having>
	<power></power>    
  </query>
  <query>
    <pool></pool>     
    <name value="geProduceLineByKey" />
    <where>
      <w name="A.codeName" des=""  reqName="keyword1" dtype="ch" oper="like"  lg="AND" bt="" />
    </where>
    <select>
      <f name="recordId" alias="" ctype="" />
      <f name="codeId" alias="" ctype="" />
      <f name="codeName" alias="" ctype="" />
      <f name="parentId" alias="" ctype="" />
      <f name="subId" alias="" ctype="" />
    </select>
    <!-- status = '0' 表示 订单状态为 "新建"  A.status = '0' AND   -->
    <from> s_producelinecode a where a.multiLevel='2' AND a.deleteFlag='0'
    </from>
    <orderby>a.codeId</orderby>
    <groupby></groupby>
    <having></having>
	<power></power>    
  </query>
  <query>
    <pool></pool>    
    <name value="getProducePlanMaxSortNo" />
    <where>
      <w name="A.produceLine" des=""  reqName="produceLine" dtype="ch" oper="="  lg="AND" bt="" />
     </where>
  	<select>
      <f name=" IFNULL(max(sortNo+1),'1')" alias="sortNo" ctype="" />
  </select>
    <from>b_ProducePlan AS A  WHERE a.deleteFlag='0' </from>
    <orderby></orderby>
    <groupby></groupby>
    <having></having>
	<power></power>    
  </query>
</root>